import './polyfills.server.mjs';
import{b as K,c as q,f as Z}from"./chunk-RLVMNVTV.mjs";import{a as z,b as G}from"./chunk-ZYNMR3FV.mjs";import{c as H}from"./chunk-XYF5ZNBO.mjs";import{b as F,c as Q}from"./chunk-UBCID47O.mjs";import{a as J}from"./chunk-NJYFXIAT.mjs";import"./chunk-37SWU3SZ.mjs";import"./chunk-IQJQIJPP.mjs";import{H as V,n as N,w as R}from"./chunk-TNSAREYT.mjs";import{c as A,e as O}from"./chunk-KCQOCMHZ.mjs";import{Ab as j,C as x,G as w,Gb as P,Ha as I,Hb as L,Jb as U,Na as k,Sa as g,Ta as p,V as C,X as _,Y as S,eb as M,f,fb as E,gb as i,hb as n,ia as y,ib as d,m as b,ob as h,pb as D,qc as B,s as v,sb as T,tb as c,ub as u}from"./chunk-OUEVK6MT.mjs";import"./chunk-KRLCULJA.mjs";var W=["progressBar"];function X(a,s){if(a&1&&d(0,"img",20),a&2){let $=D();T("src",$.userImage,I)}}function Y(a,s){a&1&&d(0,"div",21)}var fe=(()=>{let s=class s{constructor(t,r,e,o){if(this.store=t,this.router=r,this.renderer=e,this.dialog=o,this.fullname="fullname",this.email="email",this.ngUnsubscribe=new f,this.userImage="",console.log("dashboard"),typeof localStorage<"u")if(localStorage.setItem("throw_data_initializer","dS@%Rwey)hCd5DZKP87jkVdm"),localStorage?.length!==0){let m=localStorage.getItem("token");if(m){let l=F(JSON.parse(m),Q.secretKey);this.fullname=l.userLoggedIn.name+" "+l.userLoggedIn.surname,this.email=l.userLoggedIn.email,this.store.dispatch(H({id:l.userLoggedIn.id,token:l.token}))}else console.warn("localStorage is empty."),window.location.href="/login"}else console.warn("localStorage is not defined."),window.location.href="/login";console.log("end of constructor")}ngAfterViewInit(){console.log("after view init"),v([this.store.select(K),this.store.select(q)]).pipe(C(1),w(1),S(this.ngUnsubscribe),_(([t,r])=>{if(r===!1)return Z(this.dialog,"UPS! \u{1F631}","Al parecer tu sesi\xF3n ha expirado. Vuelve a iniciar sesi\xF3n\u{1F644}.",!1,()=>{localStorage.clear(),sessionStorage.clear(),window.location.href="/login"}),[];if(console.log("progress: ",t),t){let e=this.calculateProgress(t);this.setUserImage(e),this.createProgressBar(e)}return[]}),x(t=>(console.error("Error en ngAfterViewInit:",t),b([])))).subscribe(()=>{console.log("end of after view init")})}ngOnDestroy(){this.ngUnsubscribe.complete()}goToActivities(){window.location.href="/activity"}onSettingsClick(){this.router.navigate(["/settings"])}onLogoutClick(){localStorage.length!==0&&(localStorage.removeItem("token"),window.location.href="/login")}calculateProgress(t){let r=0,e=0;t.forEach(l=>{r+=l.total_levels,e+=Number(l.completed_levels)});let o=e/r*100;return Number(o.toFixed(2))}createProgressBar(t){let r=this.progressBar?.nativeElement;r.innerHTML="";let e=this.renderer.createElement("div");this.renderer.addClass(e,"progress-bar"),this.renderer.setStyle(e,"width",t+"%");let o=this.renderer.createElement("p");this.renderer.addClass(o,"progress-text");let m=this.renderer.createText(t+"%");this.renderer.appendChild(o,m),this.renderer.appendChild(e,o),this.renderer.appendChild(r,e)}getTierName(t){let r=["Bronce","Plata","Oro","Diamante"];return r[Math.min(Math.floor((t-1)/5),r.length-1)]+(t%5||5)}setUserImage(t){if(console.log("percentage: ",t),t<0||t>100)return;let r=Math.floor(t/5)+1,e=this.getTierName(r);console.log("tier: ",e),this.userImage=`../../../assets/badges/badge${e}.png`}};s.\u0275fac=function(r){return new(r||s)(p(N),p(A),p(k),p(J))},s.\u0275cmp=y({type:s,selectors:[["app-dashboard"]],viewQuery:function(r,e){if(r&1&&L(W,7),r&2){let o;P(o=U())&&(e.progressBar=o.first)}},standalone:!0,features:[j],decls:29,vars:3,consts:[["id","body-dashboard",1,"relative","flex","flex-col","justify-center","items-center","h-screen","bg-slate-800","overflow-auto"],[1,"absolute","right-4","top-4"],["buttonColor","secondary",3,"onClick"],[1,"log-out-icon"],[1,"relative","w-96","rounded-xl","shadow-xl","bg-slate-900/60","border-2","flex","flex-col","justify-evenly","items-center","backdrop-blur-sm"],[1,"relative","rounded-full","border-4","flex","justify-center","items-center","bg-slate-300","w-[200px]","h-[200px]","mt-20","mb-4","p-0"],["alt","badge that represents the user's progress","class","w-[200px] h-[200px] object-cover",3,"src"],[1,"shadow-md","flex","justify-center","items-center","bottom-4","right-2","w-[30px]","h-[30px]","rounded-full","border-2","border-slate-700","bg-slate-50","absolute","hover:cursor-pointer","hover:scale-[1.05]",3,"click"],[1,"color-icon"],[1,"flex","p-6","flex-col","items-center"],[1,"text-slate-50"],[1,"mt-4","w-80","h-4","rounded-lg","bg-gray-500"],["progressBar",""],[1,"w-80","mb-4","border-slate-500"],[1,"flex","flex-col","items-center","justify-center"],[1,"text-slate-500","font-light"],[1,"w-80","mt-4","border-slate-500"],[1,"mt-8"],[3,"onClick"],[1,"h-20"],["alt","badge that represents the user's progress",1,"w-[200px]","h-[200px]","object-cover",3,"src"],[1,"w-[200px]","h[200px]","bg-gray-400"]],template:function(r,e){r&1&&(i(0,"div",0)(1,"div",1)(2,"app-am-button",2),h("onClick",function(){return e.onLogoutClick()}),i(3,"mat-icon",3),c(4,"output"),n(),c(5,"Cerrar sesi\xF3n"),n()(),i(6,"div",4)(7,"div",5),M(8,X,1,1,"img",6)(9,Y,1,0),i(10,"div",7),h("click",function(){return e.onSettingsClick()}),i(11,"mat-icon",8),c(12,"settings"),n()()(),i(13,"div",9)(14,"p",10),c(15,"Progreso"),n(),d(16,"div",11,12),n(),d(18,"hr",13),i(19,"div",14)(20,"h2",10),c(21),n(),i(22,"p",15),c(23),n()(),d(24,"hr",16),i(25,"div",17)(26,"app-am-button",18),h("onClick",function(){return e.goToActivities()}),c(27,"Explorar actividades"),n()(),d(28,"div",19),n()()),r&2&&(g(8),E(8,e.userImage?8:9),g(13),u(e.fullname),g(2),u(e.email))},dependencies:[B,V,R,G,z,O],styles:[".color-icon[_ngcontent-%COMP%]{color:#414141}.log-out-icon[_ngcontent-%COMP%]{transform:rotate(180deg);margin-right:4px}.progress-bar[_ngcontent-%COMP%]{height:100%;border-radius:.375rem;background-color:#38a169}.progress-text[_ngcontent-%COMP%]{text-align:center;height:100%;line-height:100%;color:#dadada;font-size:.9rem}"]});let a=s;return a})();export{fe as default};
