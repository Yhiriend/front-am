import{a as G,b as z}from"./chunk-LKSOTWHE.js";import{b as x}from"./chunk-LSH4YPTB.js";import{a as J,f as w}from"./chunk-KDF5IEZD.js";import{a as V,b as B}from"./chunk-CGD3JEIY.js";import{b as O,c as T}from"./chunk-CDKTFCPX.js";import{a as K}from"./chunk-RRZRMO3V.js";import"./chunk-U7JTDUAZ.js";import{$ as S,$a as r,Ac as R,Bc as p,Cc as _,Dc as k,Ec as n,Fc as D,Gc as M,Hc as U,Jc as L,Kc as j,La as l,Lc as A,Ma as f,Ua as s,Ub as N,Xa as y,Ya as q,Z as F,Za as t,_a as o,a as v,aa as C,fb as h,k as b,kb as d,la as I,pb as E,rc as P}from"./chunk-UX52HZP3.js";function H(c,u){c&1&&(t(0,"p",28),d(1," Ingresa tu contrase\xF1a actual "),o())}var pe=(()=>{let u=class u{constructor(a,i,e,m){this.router=a,this.fb=i,this.dialog=e,this.store=m,this.userId=null,this.token="",this.hasPassword=!1,this.ngUnsubscribe=new b,this.editForm=new k({name:new n("",p.required),surname:new n(""),phone:new n(""),email:new n(""),password:new n(""),newPassword:new n(""),age:new n(""),gender:new n(""),address:new n("")}),this.genderList=[{value:"MASCULINO",label:"MASCULINO"},{value:"FEMENINO",label:"FEMENINO"}]}ngOnDestroy(){this.store.complete(),this.ngUnsubscribe.complete()}ngOnInit(){let a=this.getDataFromLocalStorage();a.token||(window.location.href="/login");let i=a.userLoggedIn;this.userId=i.id,this.token=a.token,this.editForm=this.fb.group({name:new n(i.name,p.required),surname:new n(i.surname,p.required),phone:new n(i.phone??null),email:new n(i.email,[p.required,p.email]),password:new n("",p.required),newPassword:new n(""),age:new n(i.age??null),gender:new n(i.gender??""),address:new n(i.address??null)}),this.editForm.get("password")?.valueChanges.subscribe(e=>{e?this.hasPassword=!0:this.hasPassword=!1})}onLogoutClick(){localStorage.length!==0&&(localStorage.removeItem("token"),window.location.href="/login")}onCancelEditing(){window.location.href="/dashboard"}onSubmit(a){if(a.preventDefault(),this.editForm.valid){let i={id:this.userId,name:this.editForm.controls.name.value?.toUpperCase(),surname:this.editForm.controls.surname.value?.toUpperCase(),email:this.editForm.controls.email.value?.toUpperCase(),address:this.editForm.controls.address.value??null,age:Number(this.editForm.controls.age.value)===0?null:Number(this.editForm.controls.age.value),gender:this.editForm.controls.gender.value??null,phone:this.editForm.controls.phone.value??null,password:this.editForm.controls.password.value},e=this.editForm.controls.newPassword.value;this.store.dispatch(V({user:i,newPassword:e,token:this.token})),this.store.select(J).pipe(F(1),C(this.ngUnsubscribe),S(m=>{if(!m){w(this.dialog,"Ups! \u{1F636}","Algo sali\xF3 mal \u{1F613}. Valida que tu contrase\xF1a actual sea la correcta o int\xE9ntalo m\xE1s tarde.",!1,()=>{});let g=v({},m);return this.store.dispatch(B({result:{msg:null}})),!g}m&&w(this.dialog,"Datos Actualizados","Tus datos han sido actualizados. Para que puedas ver reflejado los cambios debes volver a iniciar sesi\xF3n \u{1F644}. Adem\xE1s, debes tener en cuenta que si actualizaste tambi\xE9n tu correo o contrase\xF1a, debes iniciar sesi\xF3n con el nuevo correo y la nueva contrase\xF1a \u{1F60B}\u{1F60B} ",!1,()=>{localStorage.removeItem("token"),window.location.href="/login"})})).subscribe()}else this.editForm.controls.password.status==="INVALID"&&w(this.dialog,"\xA1Datos incompletos! \u{1F636}","Para poder actualizar tus datos, debemos validar que realmente eres t\xFA \u{1F644}, para ello debes ingresar tu contrase\xF1a actual.",!1,()=>{})}getDataFromLocalStorage(){let a=localStorage.getItem("token"),i={};return a&&(i=O(JSON.parse(a),T.secretKey)),i}};u.\u0275fac=function(i){return new(i||u)(f(x),f(U),f(K),f(P))},u.\u0275cmp=I({type:u,selectors:[["app-profile"]],standalone:!0,features:[E],decls:49,vars:21,consts:[["id","body-settings",1,"w-full","h-full","flex","justify-center","items-center","flex-col","bg-slate-800","p-10"],[1,"absolute","right-4","top-4"],["buttonColor","secondary",3,"onClick"],[1,"log-out-icon"],[1,"font-bold","text-slate-200","text-4xl","text-center","my-8"],[1,"flex","flex-col","justify-start","items-center","bg-white","opacity-90","shadow-lg","border-2","rounded-lg","w-[700px]","h-4/5","p-4","overflow-y-scroll"],[1,"relative","w-full","h-fit","p-0","flex","justify-center","flex-col","items-center",3,"formGroup","submit"],[1,"text-left","text-slate-500","w-full","pl-1"],[1,"w-full","border-slate-200","mb-1"],[1,"w-full","flex"],[1,"m-2","w-full"],["inputId","name","inputName","name","placeholder","Primer nombre",3,"control","inputRequired"],["inputId","surname","inputName","surname","placeholder","Primer apellido",3,"control","inputRequired"],[1,"w-full","flex","mb-4"],["type","number","inputId","age","inputName","age","placeholder","Edad",3,"control","inputRequired"],["type","selector","inputId","gender","inputName","gender","placeholder","G\xE9nero (masculino/femenino)",3,"options","control","inputRequired"],["inputId","phone","inputName","phone","placeholder","Tel\xE9fono",3,"control","inputRequired"],["inputId","email","inputName","email","placeholder","Correo electr\xF3nico",3,"control","inputRequired"],[1,"mt-2","mb-6","w-[97%]"],["inputId","address","inputName","address","placeholder","Direcci\xF3n de residencia",3,"control","inputRequired"],[1,"flex","w-full"],["inputId","password","inputName","password","placeholder","Contrase\xF1a actual",3,"control","inputRequired"],["inputId","newPassword","inputName","newPassword","placeholder","Nueva contrase\xF1a",3,"control","inputRequired"],[1,"relative","mt-6","mb-4","w-full"],["class","absolute w-full text-center top-[-15px] text-red-700 text-sm"],[1,"w-full","mt-4"],["buttonType","submit"],[1,"w-full"],[1,"absolute","w-full","text-center","top-[-15px]","text-red-700","text-sm"]],template:function(i,e){i&1&&(t(0,"div",0)(1,"div",1)(2,"app-am-button",2),h("onClick",function(){return e.onLogoutClick()}),t(3,"mat-icon",3),d(4,"output"),o(),d(5,"Cerrar sesi\xF3n"),o()(),t(6,"h1",4),d(7," Configurar mi Perfil "),o(),t(8,"div",5)(9,"form",6),h("submit",function(g){return e.onSubmit(g)}),t(10,"p",7),d(11,"Datos personales"),o(),r(12,"hr",8),t(13,"div",9)(14,"div",10),r(15,"app-am-input",11),o(),t(16,"div",10),r(17,"app-am-input",12),o()(),t(18,"div",13)(19,"div",10),r(20,"app-am-input",14),o(),t(21,"div",10),r(22,"app-am-input",15),o()(),t(23,"p",7),d(24,"Datos de contacto"),o(),r(25,"hr",8),t(26,"div",9)(27,"div",10),r(28,"app-am-input",16),o(),t(29,"div",10),r(30,"app-am-input",17),o()(),t(31,"div",18),r(32,"app-am-input",19),o(),t(33,"p",7),d(34,"Cambio de contrase\xF1a"),o(),r(35,"hr",8),t(36,"div",20)(37,"div",10),r(38,"app-am-input",21),o(),t(39,"div",10),r(40,"app-am-input",22),o()(),t(41,"div",23),y(42,H,2,0,"p",24),t(43,"div",25)(44,"app-am-button",26),d(45,"Guardar cambios"),o()()(),t(46,"div",27)(47,"app-am-button",2),h("onClick",function(){return e.onCancelEditing()}),d(48,"Cancelar"),o()()()()()),i&2&&(l(9),s("formGroup",e.editForm),l(6),s("control",e.editForm.controls.name)("inputRequired",!1),l(2),s("control",e.editForm.controls.surname)("inputRequired",!1),l(3),s("control",e.editForm.controls.age)("inputRequired",!1),l(2),s("options",e.genderList)("control",e.editForm.controls.gender)("inputRequired",!1),l(6),s("control",e.editForm.controls.phone)("inputRequired",!1),l(2),s("control",e.editForm.controls.email)("inputRequired",!1),l(2),s("control",e.editForm.controls.address)("inputRequired",!1),l(6),s("control",e.editForm.controls.password)("inputRequired",!1),l(2),s("control",e.editForm.controls.newPassword)("inputRequired",!1),l(2),q(42,e.hasPassword?-1:42))},dependencies:[N,A,R,j,z,G,L,D,_,M],styles:[".log-out-icon[_ngcontent-%COMP%]{transform:rotate(180deg);margin-right:4px}"]});let c=u;return c})();export{pe as default};
